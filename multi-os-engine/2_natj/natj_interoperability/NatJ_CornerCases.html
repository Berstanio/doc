

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Nat/J: Corner Cases &mdash; Multi-OS Engine Documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Multi-OS Engine Documentation" href="../../../index.html"/>
        <link rel="up" title="Nat/J: Interoperability with Native Code" href="NatJ_Interoperability.html"/>
        <link rel="next" title="Nat/J: Reference" href="natj_reference/packages.html"/>
        <link rel="prev" title="Nat/J: How-to" href="NatJ_How_to.html"/>
     
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75001976-1', 'auto');
  ga('send', 'pageview');

</script>


  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Multi-OS Engine Documentation
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../MultiOSEngine.html">Multi-OS Engine</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../1_getting_started/Getting_Started.html">Getting Started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../NatJ.html">Nat/J library for Java to native binding</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="NatJ_Interoperability.html">Nat/J: Interoperability with Native Code</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="NatJ_How_to.html">Nat/J: How-to</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">Nat/J: Corner Cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="natj_reference/packages.html">Nat/J: Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../natjgen_binding_generator/NatJGen_Binding_Generator.html">Nat/J Binding Generator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../working_with_pointers/Working_With_Pointers.html">Working with Pointers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../toll_free_bridging/Toll_Free_Bridging.html">Toll-Free Bridging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../3_iOS_app_development/iOS_app_development.html">iOS apps development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../6_moe_architecture/MOE_Architecture.html">Multi-OS Engine Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../7_Troubleshooting/troubleshooting.html">Known issues and troubleshooting</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Multi-OS Engine Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../MultiOSEngine.html">Multi-OS Engine</a> &raquo;</li>
      
          <li><a href="../NatJ.html">Nat/J library for Java to native binding</a> &raquo;</li>
      
          <li><a href="NatJ_Interoperability.html">Nat/J: Interoperability with Native Code</a> &raquo;</li>
      
    <li>Nat/J: Corner Cases</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="nat-j-corner-cases">
<h1>Nat/J: Corner Cases<a class="headerlink" href="#nat-j-corner-cases" title="Permalink to this headline">Â¶</a></h1>
<p>In this section some corner cases get mentioned that requires great care and attention to avoid any inconveniences.</p>
<p><strong>Non-Retained Problem</strong></p>
<p>In Objective-C memory management there are three main property qualifiers: copy, strong (retain), assign.</p>
<ul class="simple">
<li>When a property is marked as copy, then the assigned object will be copied (through the <code class="docutils literal"><span class="pre">NSCopying</span></code> protocol).</li>
<li>When a property is marked as strong, then the assigned object will be retained (its reference count will be incremented).</li>
<li>But when a property is marked with assign, then only the value will be set.</li>
</ul>
<p>A problem is caused by the last statement when working with Objective-C binding methods in Java, because the binding
method&#8217;s parameter is not marked with this information, only the documentation contains this information.</p>
<p><em>As a workaround iOS binding code has safe and unsafe versions of a non-retained property setter method.</em> The safe setter
creates a reference for the specified object on the Java side to prevent unwanted freeing from the GC and the unsafe setter
simply invokes the Objective-C code.</p>
<p>Let&#8217;s look at this simple example where we have two main classes:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">MyDataSource</span></code> - which is a simple class extending <code class="docutils literal"><span class="pre">NSObject</span></code> and implementing <code class="docutils literal"><span class="pre">UITableViewDataSource</span></code>. This class stores
all the row information and everything related to being a datasource.</li>
<li><code class="docutils literal"><span class="pre">TableController</span></code> - which is a view controller extending <code class="docutils literal"><span class="pre">UITableViewController</span></code>. This will be our root view controller.</li>
</ul>
</div></blockquote>
<p>Let&#8217;s say this is our <code class="docutils literal"><span class="pre">viewDidLoad</span></code> method:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="nd">@Selector</span><span class="o">(</span><span class="s">&quot;viewDidLoad&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">viewDidLoad</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">viewDidLoad</span><span class="o">();</span>

        <span class="n">tableView</span><span class="o">().</span><span class="na">registerClassForCellReuseIdentifier</span><span class="o">(</span>
                        <span class="k">new</span> <span class="n">com</span><span class="o">.</span><span class="na">intel</span><span class="o">.</span><span class="na">inde</span><span class="o">.</span><span class="na">moe</span><span class="o">.</span><span class="na">natj</span><span class="o">.</span><span class="na">objc</span><span class="o">.</span><span class="na">Class</span><span class="o">(</span><span class="s">&quot;UITableViewCell&quot;</span><span class="o">),</span>
                        <span class="n">MyDataSource</span><span class="o">.</span><span class="na">CELL_IDENTIFIER</span><span class="o">);</span>

        <span class="n">MyDataSource</span> <span class="n">source</span> <span class="o">=</span> <span class="n">MyDataSource</span><span class="o">.</span><span class="na">alloc</span><span class="o">().</span><span class="na">init</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">source</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">tableView</span><span class="o">().</span><span class="na">setDataSource_unsafe</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
        <span class="n">tableView</span><span class="o">().</span><span class="na">reloadData</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Basically we register a cell reuse identifier with the table view, fill up the data source with 10000 rows, set the data source
property of the table view and reload the data.</p>
<p>The code looks ok and you could even probably start the application with no problem. The problem will only occur when Java
VM&#8217;s garbage collector decides to do a cleanup. The garbage collector has no idea that it needs to keep the Java <code class="docutils literal"><span class="pre">MyDataSource</span></code>
object alive - because the only reference to it is on the Objective-C side - and frees it, but <code class="docutils literal"><span class="pre">UITableView</span></code>&#8216;s data source
handling is very dynamic, so when the user scrolls after the GC freeing, the table view will ask the data source about the next
row it needs to display (and other info as well), but at that point the object was already freed thus causing an <code class="docutils literal"><span class="pre">EXC_BAD_ACCESS</span></code>
exception or rendering the application unusable.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="natj_reference/packages.html" class="btn btn-neutral float-right" title="Nat/J: Reference" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="NatJ_How_to.html" class="btn btn-neutral" title="Nat/J: How-to" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Intel.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>